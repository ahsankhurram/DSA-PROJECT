import java.util.Scanner;

class Complaint {
    String id;
    String citizen;
    String area;
    String type;
    String severity;
    Complaint next;

    Complaint(String id, String citizen, String area, String type, String severity) {
        this.id = id;
        this.citizen = citizen;
        this.area = area;
        this.type = type;
        this.severity = severity;
        this.next = null;
    }

    public String toString() {
        return id + " | " + citizen + " | " + area + " | " + type + " | " + severity;
    }
}

class SimpleLinkedList {
    Complaint head;

    void addLast(Complaint c) {
        if (head == null) {
            head = c;
            return;
        }
        Complaint temp = head;
        while (temp.next != null) {
            temp = temp.next;
        }
        temp.next = c;
    }

    Complaint find(String id) {
        Complaint temp = head;
        while (temp != null) {
            if (temp.id.equals(id)) return temp;
            temp = temp.next;
        }
        return null;
    }

    void showAll() {
        Complaint t = head;
        while (t != null) {
            System.out.println(t.toString());
            t = t.next;
        }
    }

    int size() {
        int c = 0;
        Complaint t = head;
        while (t != null) {
            c++;
            t = t.next;
        }
        return c;
    }

    Complaint[] toArray() {
        int n = size();
        Complaint[] arr = new Complaint[n];
        Complaint t = head;
        int i = 0;
        while (t != null) {
            arr[i] = t;
            t = t.next;
            i++;
        }
        return arr;
    }
}

class SimpleQueue {
    Complaint[] arr = new Complaint[100];
    int front = 0, rear = -1;

    void enqueue(Complaint c) {
        rear++;
        arr[rear] = c;
        System.out.println("Added to queue: " + c.id);
    }

    Complaint dequeue() {
        if (front > rear) return null;
        Complaint c = arr[front];
        front++;
        return c;
    }

    boolean isEmpty() {
        return front > rear;
    }
}

class SimpleStack {
    Complaint[] arr = new Complaint[100];
    int top = -1;

    void push(Complaint c) {
        top++;
        arr[top] = c;
    }

    Complaint pop() {
        if (top < 0) return null;
        Complaint c = arr[top];
        top--;
        return c;
    }

    boolean isEmpty() {
        return top < 0;
    }
}

class MinHeap {
    Complaint[] heap = new Complaint[100];
    int size = 0;

    int priorityValue(String s) {
        if (s.equalsIgnoreCase("CRITICAL")) return 1;
        if (s.equalsIgnoreCase("HIGH")) return 2;
        if (s.equalsIgnoreCase("MEDIUM")) return 3;
        return 4;
    }

    void insert(Complaint c) {
        heap[++size] = c;
        int i = size;
        while (i > 1 && priorityValue(heap[i].severity) < priorityValue(heap[i/2].severity)) {
            Complaint temp = heap[i];
            heap[i] = heap[i/2];
            heap[i/2] = temp;
            i /= 2;
        }
        System.out.println("Added to priority queue: " + c.id);
    }

    Complaint removeMin() {
        if (size == 0) return null;
        Complaint root = heap[1];
        heap[1] = heap[size];
        size--;
        int i = 1;
        while (true) {
            int left = 2 * i;
            int right = 2 * i + 1;
            int smallest = i;
            if (left <= size && priorityValue(heap[left].severity) < priorityValue(heap[smallest].severity))
                smallest = left;
            if (right <= size && priorityValue(heap[right].severity) < priorityValue(heap[smallest].severity))
                smallest = right;
            if (smallest != i) {
                Complaint temp = heap[i];
                heap[i] = heap[smallest];
                heap[smallest] = temp;
                i = smallest;
            } else break;
        }
        return root;
    }

    boolean isEmpty() {
        return size == 0;
    }
}

class SimpleSort {
    static void sortByArea(Complaint[] arr) {
        int n = arr.length;
        for (int i = 0; i < n - 1; i++) {
            for (int j = 0; j < n - 1 - i; j++) {
                if (arr[j].area.compareTo(arr[j + 1].area) > 0) {
                    Complaint temp = arr[j];
                    arr[j] = arr[j + 1];
                    arr[j + 1] = temp;
                }
            }
        }
    }
}

public class AppMain {
    static Scanner sc = new Scanner(System.in);
    static SimpleLinkedList records = new SimpleLinkedList();
    static SimpleQueue queue = new SimpleQueue();
    static SimpleStack undo = new SimpleStack();
    static MinHeap heap = new MinHeap();
    static int idCounter = 1;

    public static void main(String[] args) {
        while (true) {
            System.out.println("\n==== Karachi Complaint System ====");
            System.out.println("1. Register Complaint");
            System.out.println("2. Show All Complaints");
            System.out.println("3. Add to Processing Queue");
            System.out.println("4. Process Next from Queue");
            System.out.println("5. Add to Priority Queue");
            System.out.println("6. Serve Priority Complaint");
            System.out.println("7. Undo Last Operation");
            System.out.println("8. Sort by Area (Bubble Sort)");
            System.out.println("0. Exit");
            System.out.print("Choose: ");
            String op = sc.nextLine();

            if (op.equals("1")) addComplaint();
            else if (op.equals("2")) records.showAll();
            else if (op.equals("3")) addToQueue();
            else if (op.equals("4")) processQueue();
            else if (op.equals("5")) addToPriorityQueue();
            else if (op.equals("6")) servePriority();
            else if (op.equals("7")) undoOperation();
            else if (op.equals("8")) sortAndShow();
            else if (op.equals("0")) break;
        }
        System.out.println("System Ended.");
    }

    static void addComplaint() {
        System.out.print("Citizen: ");
        String name = sc.nextLine();
        System.out.print("Area: ");
        String area = sc.nextLine();
        System.out.print("Type: ");
        String type = sc.nextLine();
        System.out.print("Severity (Critical/High/Medium/Low): ");
        String sev = sc.nextLine();

        String id = "C" + idCounter++;
        Complaint c = new Complaint(id, name, area, type, sev);

        records.addLast(c);
        undo.push(c);

        System.out.println("Complaint Added: " + c.id);
    }

    static void addToQueue() {
        System.out.print("Enter ID: ");
        String id = sc.nextLine();
        Complaint c = records.find(id);
        if (c == null) {
            System.out.println("Not found.");
            return;
        }
        queue.enqueue(c);
    }

    static void processQueue() {
        Complaint c = queue.dequeue();
        if (c == null) {
            System.out.println("Queue empty.");
            return;
        }
        undo.push(c);
        System.out.println("Processed: " + c.toString());
    }

    static void addToPriorityQueue() {
        System.out.print("Enter ID: ");
        String id = sc.nextLine();
        Complaint c = records.find(id);
        if (c == null) {
            System.out.println("Not found.");
            return;
        }
        heap.insert(c);
    }

    static void servePriority() {
        Complaint c = heap.removeMin();
        if (c == null) {
            System.out.println("Priority queue empty.");
            return;
        }
        undo.push(c);
        System.out.println("Served Priority: " + c.toString());
    }

    static void undoOperation() {
        Complaint c = undo.pop();
        if (c == null) {
            System.out.println("Nothing to undo.");
            return;
        }
        records.addLast(c);
        System.out.println("Undo done. Restored: " + c.id);
    }

    static void sortAndShow() {
        Complaint[] arr = records.toArray();
        SimpleSort.sortByArea(arr);
        System.out.println("Sorted by Area:");
        for (int i = 0; i < arr.length; i++) {
            System.out.println(arr[i].toString());
        }
    }
}
